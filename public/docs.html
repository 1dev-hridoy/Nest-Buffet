<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>REST API Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
      body {
          font-family: 'Inter', sans-serif;
          background-color: #0f172a;
          color: #e2e8f0;
      }
      .sidebar {
          width: 260px;
          transition: all 0.3s;
          background-color: #1e293b;
      }
      .main-content {
          transition: all 0.3s;
      }
      .api-card {
          transition: all 0.2s;
          background-color: #1e293b;
      }
      .api-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      }
      .modal {
          transition: all 0.3s;
      }
      .modal-content {
          transition: all 0.3s;
          transform: scale(0.95);
          opacity: 0;
          background-color: #1e293b;
          max-height: 90vh; /* Limit modal height to 90% of viewport height */
          display: flex;
          flex-direction: column;
      }
      .modal.active .modal-content {
          transform: scale(1);
          opacity: 1;
      }
      .modal-body {
          flex: 1;
          overflow-y: auto; /* Enable vertical scrolling */
          padding: 1.5rem; /* Match padding with header/footer */
      }
      ::-webkit-scrollbar {
          width: 8px;
          height: 8px;
      }
      ::-webkit-scrollbar-track {
          background: #1e293b;
      }
      ::-webkit-scrollbar-thumb {
          background: #475569;
          border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
          background: #64748b;
      }
      @media (max-width: 768px) {
          .sidebar {
              position: fixed;
              left: -100%;
              top: 0;
              bottom: 0;
              z-index: 50;
              transition: left 0.3s ease;
              width: 85%;
              max-width: 300px;
          }
          .sidebar.active {
              left: 0;
          }
          .overlay {
              position: fixed;
              inset: 0;
              background-color: rgba(0, 0, 0, 0.5);
              z-index: 40;
              opacity: 0;
              pointer-events: none;
              transition: opacity 0.3s ease;
          }
          .overlay.active {
              opacity: 1;
              pointer-events: auto;
          }
      }
      .modal-close-btn {
          position: absolute;
          top: -15px;
          right: -15px;
          background: #7c3aed;
          color: white;
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
          z-index: 60;
      }
      .status-indicator {
          width: 10px;
          height: 10px;
          border-radius: 50%;
          display: inline-block;
          margin-right: 6px;
      }
      .status-online {
          background-color: #10b981;
          box-shadow: 0 0 8px #10b981;
      }
      .tab-content {
          display: none;
      }
      .tab-content.active {
          display: block;
      }
      .input-error {
          border-color: #f87171 !important;
      }
      .error-message {
          color: #f87171;
          font-size: 0.75rem;
          margin-top: 0.25rem;
      }
      .body-tab-button {
          padding: 0.5rem 1rem;
          border-radius: 0.375rem;
          background-color: #374151;
          color: #d1d5db;
          margin-right: 0.5rem;
      }
      .body-tab-button.active {
          background-color: #7c3aed;
          color: #ffffff;
      }
  </style>
</head>
<body class="text-gray-200">
  <div class="overlay" id="overlay"></div>
  <div class="flex min-h-screen relative">
      <!-- Sidebar -->
      <div class="sidebar border-r border-gray-700 h-screen flex flex-col z-50" id="sidebar">
          <div class="p-4 border-b border-gray-700 flex justify-between items-center">
              <h1 class="text-xl font-bold text-gray-100 flex items-center">
                  <i class="fa-solid fa-bolt text-purple-500 mr-2"></i>
                  API Hub
              </h1>
              <button class="md:hidden text-gray-400 hover:text-gray-200 p-2" id="close-sidebar">
                  <i class="fa-solid fa-xmark text-lg"></i>
              </button>
          </div>
          <div class="overflow-y-auto flex-grow">
              <div class="p-4">
                  <div class="mb-4">
                      <p class="text-xs uppercase text-gray-400 font-semibold mb-2">API Documentation</p>
                      <ul class="space-y-1" id="sidebar-categories"></ul>
                  </div>
                  <div>
                      <p class="text-xs uppercase text-gray-400 font-semibold mb-2">Tools</p>
                      <ul class="space-y-1">
                          <li>
                              <a href="#" class="flex items-center p-2 rounded-md hover:bg-gray-700/50">
                                  <i class="fa-solid fa-gear text-sm mr-2"></i>
                                  Settings
                              </a>
                          </li>
                          <li>
                              <a href="#" class="flex items-center p-2 rounded-md hover:bg-gray-700/50">
                                  <i class="fa-solid fa-circle-question text-sm mr-2"></i>
                                  Help & Support
                              </a>
                          </li>
                      </ul>
                  </div>
              </div>
          </div>
          <div class="p-4 border-t border-gray-700">
              <div class="flex items-center">
                  <div class="w-8 h-8 rounded-full bg-purple-900/50 flex items-center justify-center text-purple-300 font-semibold">JD</div>
                  <div class="ml-2">
                      <p class="text-sm font-medium">John Doe</p>
                      <p class="text-xs text-gray-400">Developer</p>
                  </div>
              </div>
          </div>
      </div>

      <!-- Main Content -->
      <div class="main-content flex-1 overflow-y-auto">
          <header class="bg-gray-800 border-b border-gray-700 py-4 px-4 sm:px-6 flex items-center justify-between sticky top-0 z-20">
              <div class="flex items-center">
                  <button class="mr-4 md:hidden text-gray-300 hover:text-white p-2" id="open-sidebar">
                      <i class="fa-solid fa-bars text-lg"></i>
                  </button>
                  <h2 class="text-lg font-semibold text-white">API Dashboard</h2>
              </div>
              <div class="flex items-center">
                  <div class="hidden md:flex items-center mr-4 text-sm">
                      <span class="status-indicator status-online"></span>
                      <span class="mr-2">Server Online</span>
                      <span id="current-time" class="font-mono">00:00:00</span>
                  </div>
                  <div class="relative mr-4 hidden sm:block">
                      <input type="text" placeholder="Search APIs..." class="w-48 md:w-64 pl-10 pr-4 py-2 rounded-md bg-gray-700 border border-gray-600 text-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                      <i class="fa-solid fa-search text-gray-400 absolute left-3 top-2.5"></i>
                  </div>
                  <button class="p-2 rounded-md hover:bg-gray-700">
                      <i class="fa-solid fa-bell text-gray-300"></i>
                  </button>
              </div>
          </header>

          <div class="p-4 sm:p-6">
              <!-- Dashboard Overview -->
              <div class="mb-8" id="dashboard-overview">
                  <h3 class="text-lg font-semibold mb-4 text-white">API Statistics</h3>
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-sm">
                          <div class="flex items-center">
                              <div class="p-3 rounded-md bg-purple-900/30 text-purple-400">
                                  <i class="fa-solid fa-check-circle text-lg"></i>
                              </div>
                              <div class="ml-4">
                                  <p class="text-sm text-gray-400">Total APIs</p>
                                  <p class="text-xl font-semibold text-white" id="total-apis">0</p>
                              </div>
                          </div>
                      </div>
                      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-sm">
                          <div class="flex items-center">
                              <div class="p-3 rounded-md bg-blue-900/30 text-blue-400">
                                  <i class="fa-solid fa-arrow-down text-lg"></i>
                              </div>
                              <div class="ml-4">
                                  <p class="text-sm text-gray-400">GET APIs</p>
                                  <p class="text-xl font-semibold text-white" id="get-apis">0</p>
                              </div>
                          </div>
                      </div>
                      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-sm">
                          <div class="flex items-center">
                              <div class="p-3 rounded-md bg-green-900/30 text-green-400">
                                  <i class="fa-solid fa-arrow-up text-lg"></i>
                              </div>
                              <div class="ml-4">
                                  <p class="text-sm text-gray-400">POST APIs</p>
                                  <p class="text-xl font-semibold text-white" id="post-apis">0</p>
                              </div>
                          </div>
                      </div>
                      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-sm">
                          <div class="flex items-center">
                              <div class="p-3 rounded-md bg-yellow-900/30 text-yellow-400">
                                  <i class="fa-solid fa-clock text-lg"></i>
                              </div>
                              <div class="ml-4">
                                  <p class="text-sm text-gray-400">Server Uptime</p>
                                  <p class="text-xl font-semibold text-white" id="server-uptime">0%</p>
                              </div>
                          </div>
                      </div>
                  </div>

                  <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-sm">
                          <h4 class="text-sm font-medium text-gray-300 mb-3">API Calls Today</h4>
                          <div class="flex items-center justify-between">
                              <div class="flex items-center">
                                  <div class="p-3 rounded-md bg-purple-900/30 text-purple-400">
                                      <i class="fa-solid fa-chart-simple text-lg"></i>
                                  </div>
                                  <div class="ml-4">
                                      <p class="text-xl font-semibold text-white" id="api-calls-today">0</p>
                                      <p class="text-xs text-green-400" id="api-calls-change">+0% from yesterday</p>
                                  </div>
                              </div>
                              <div class="text-right">
                                  <p class="text-sm text-gray-400">Peak: <span id="peak-calls">0</span> calls/min</p>
                                  <p class="text-xs text-gray-500">Last updated: <span id="last-updated">Just now</span></p>
                              </div>
                          </div>
                      </div>
                      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-sm">
                          <h4 class="text-sm font-medium text-gray-300 mb-3">Server Performance</h4>
                          <div class="flex items-center justify-between">
                              <div class="flex items-center">
                                  <div class="p-3 rounded-md bg-blue-900/30 text-blue-400">
                                      <i class="fa-solid fa-bolt text-lg"></i>
                                  </div>
                                  <div class="ml-4">
                                      <p class="text-xl font-semibold text-white" id="response-time">0ms</p>
                                      <p class="text-xs text-green-400" id="response-time-change">0ms from average</p>
                                  </div>
                              </div>
                              <div class="text-right">
                                  <p class="text-sm text-gray-400">CPU: <span id="cpu-usage">0%</span></p>
                                  <p class="text-sm text-gray-400">Memory: <span id="memory-usage">0GB/8GB</span></p>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- API Documentation -->
              <div class="mb-8" id="api-categories">
                  <div class="flex items-center justify-between mb-4">
                      <h3 class="text-lg font-semibold text-white">API Documentation</h3>
                      <button class="text-sm text-purple-400 hover:text-purple-300 flex items-center">
                          View All
                          <i class="fa-solid fa-chevron-right ml-1 text-xs"></i>
                      </button>
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="category-cards"></div>
              </div>

              <!-- API List Section -->
              <div class="mb-8 hidden" id="api-list-section">
                  <div class="flex items-center justify-between mb-4 flex-wrap gap-2">
                      <div class="flex items-center">
                          <button id="back-to-categories" class="mr-2 p-1 rounded-md hover:bg-gray-700 text-gray-300">
                              <i class="fa-solid fa-chevron-left"></i>
                          </button>
                          <h3 class="text-lg font-semibold text-white"><span id="category-title"></span> APIs</h3>
                      </div>
                      <div class="flex items-center flex-wrap gap-2">
                          <select class="mr-2 p-2 border border-gray-600 rounded-md text-sm bg-gray-700 text-gray-200" id="method-filter">
                              <option>All Methods</option>
                              <option>GET</option>
                              <option>POST</option>
                              <option>PUT</option>
                              <option>DELETE</option>
                          </select>
                          <select class="p-2 border border-gray-600 rounded-md text-sm bg-gray-700 text-gray-200" id="sort-filter">
                              <option>Sort by Name</option>
                              <option>Sort by Method</option>
                          </select>
                      </div>
                  </div>
                  <div id="api-lists"></div>
              </div>
          </div>
      </div>
  </div>

  <!-- API Test Modal -->
  <div class="modal fixed inset-0 z-50 bg-black bg-opacity-70 hidden flex items-center justify-center p-4" id="api-test-modal">
      <div class="modal-content rounded-lg shadow-xl w-full max-w-3xl mx-auto relative">
          <button id="close-modal-btn" class="modal-close-btn">
              <i class="fa-solid fa-xmark"></i>
          </button>
          <!-- Modal Header -->
          <div class="p-6 border-b border-gray-700">
              <div class="flex items-center justify-between">
                  <h3 class="text-lg font-semibold text-white" id="modal-title">Test API</h3>
                  <button id="close-modal" class="text-gray-400 hover:text-gray-200">
                      <i class="fa-solid fa-xmark text-lg"></i>
                  </button>
              </div>
          </div>
          <!-- Modal Body (Scrollable) -->
          <div class="modal-body">
              <div class="mb-6">
                  <div class="flex items-center mb-4">
                      <span class="px-2 py-1 bg-green-900/30 text-green-400 text-xs font-medium rounded mr-2" id="modal-method"></span>
                      <div class="text-sm text-gray-400 font-mono bg-gray-700/50 p-2 rounded flex-1 overflow-x-auto" id="modal-endpoint"></div>
                  </div>
                  <p class="text-sm text-gray-400" id="modal-description"></p>
              </div>
              <div class="mb-6">
                  <div class="flex mb-4 overflow-x-auto whitespace-nowrap">
                      <button class="tab-button px-4 py-2 bg-purple-600 text-white rounded-l-md" data-tab="headers">Headers</button>
                      <button class="tab-button px-4 py-2 bg-gray-700 text-gray-300 hover:bg-gray-600" data-tab="params">Params</button>
                      <button class="tab-button px-4 py-2 bg-gray-700 text-gray-300 hover:bg-gray-600" data-tab="body">Body</button>
                      <button class="tab-button px-4 py-2 bg-gray-700 text-gray-300 hover:bg-gray-600 rounded-r-md" data-tab="auth">Auth</button>
                  </div>
                  <div class="tab-content active" id="headers-tab">
                      <div class="bg-gray-700 p-4 rounded-md">
                          <div class="mb-4">
                              <label class="block text-sm font-medium text-gray-300 mb-1">Content-Type</label>
                              <input type="text" name="content-type" value="application/json" readonly class="w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-gray-200 cursor-not-allowed">
                          </div>
                          <div>
                              <label class="block text-sm font-medium text-gray-300 mb-1">Authorization</label>
                              <input type="text" name="authorization" placeholder="Bearer token" class="w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-gray-200">
                          </div>
                          <div>
                              <label class="block text-sm font-medium text-gray-300 mb-1 mt-4">X-User-Role</label>
                              <input type="text" name="x-user-role" value="user" class="w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-gray-200">
                          </div>
                      </div>
                  </div>
                  <div class="tab-content" id="params-tab">
                      <div class="bg-gray-700 p-4 rounded-md" id="params-container"></div>
                  </div>
                  <div class="tab-content" id="body-tab">
                      <div class="bg-gray-700 p-4 rounded-md">
                          <div class="flex mb-4">
                              <button class="body-tab-button active" data-body-tab="form">Form Inputs</button>
                              <button class="body-tab-button" data-body-tab="raw">Raw JSON</button>
                          </div>
                          <div class="body-tab-content active" id="body-form-container">
                              <div id="body-inputs"></div>
                          </div>
                          <div class="body-tab-content" id="body-raw-container">
                              <textarea id="raw-json-input" class="w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-gray-200 font-mono" rows="5" placeholder='{"api": "MAINPOINT", "question": "bokacoda", "language": "bn"}'></textarea>
                              <p class="error-message hidden">Invalid JSON format</p>
                          </div>
                      </div>
                  </div>
                  <div class="tab-content" id="auth-tab">
                      <div class="bg-gray-700 p-4 rounded-md">
                          <p class="text-sm text-gray-400">Authentication is handled via headers (Authorization).</p>
                      </div>
                  </div>
              </div>
              <div class="mb-6">
                  <h4 class="text-sm font-medium text-gray-300 mb-2">Request Body</h4>
                  <div class="bg-gray-900 text-gray-300 p-4 rounded-md font-mono text-sm" id="modal-request-body"></div>
              </div>
              <div>
                  <div class="flex justify-between items-center mb-2">
                      <h4 class="text-sm font-medium text-gray-300">Response</h4>
                      <span class="text-sm text-gray-400" id="modal-response-status">Status: Not Sent</span>
                  </div>
                  <div class="bg-gray-900 text-gray-300 p-4 rounded-md font-mono text-sm h-48 overflow-y-auto" id="modal-response"></div>
              </div>
          </div>
          <!-- Modal Footer -->
          <div class="p-6 border-t border-gray-700 flex justify-end">
              <button class="px-4 py-2 bg-gray-700 text-gray-300 rounded-md mr-2 hover:bg-gray-600" id="reset-request">Reset</button>
              <button class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700" id="send-request">Send Request</button>
          </div>
      </div>
  </div>

  <script>
      // Fetch API metadata from the server
      let apiData = { categories: {}, stats: {} };
      let serverStartTime = new Date();
      let averageResponseTime = 0;
      let responseTimeCount = 0;
      let currentApiParams = [];

      async function fetchApiData() {
          try {
              const response = await fetch('/api/metadata');
              apiData = await response.json();

              // Update dashboard stats
              document.getElementById('total-apis').textContent = apiData.stats.totalApis;
              document.getElementById('get-apis').textContent = apiData.stats.getApis;
              document.getElementById('post-apis').textContent = apiData.stats.postApis;

              // Update API calls
              updateApiCalls();

              // Populate sidebar categories
              const sidebarCategories = document.getElementById('sidebar-categories');
              sidebarCategories.innerHTML = '';
              Object.keys(apiData.categories).forEach(category => {
                  const li = document.createElement('li');
                  li.innerHTML = `
                      <a href="#" class="category-link flex items-center p-2 rounded-md hover:bg-gray-700/50" data-category="${category}">
                          <i class="fa-solid fa-folder text-sm mr-2"></i>
                          ${category.charAt(0).toUpperCase() + category.slice(1)}
                      </a>
                  `;
                  sidebarCategories.appendChild(li);
              });

              // Populate category cards in API Documentation
              const categoryCards = document.getElementById('category-cards');
              categoryCards.innerHTML = '';
              Object.keys(apiData.categories).forEach(category => {
                  const categoryApis = apiData.categories[category];
                  const getCount = categoryApis.filter(api => api.method === 'GET').length;
                  const postCount = categoryApis.filter(api => api.method === 'POST').length;
                  const putCount = categoryApis.filter(api => api.method === 'PUT').length;

                  const card = document.createElement('div');
                  card.className = 'bg-gray-800 p-5 rounded-lg border border-gray-700 shadow-sm hover:shadow-md transition-all cursor-pointer category-card';
                  card.dataset.category = category;
                  card.innerHTML = `
                      <div class="flex items-center mb-3">
                          <div class="p-3 rounded-md bg-purple-900/30 text-purple-400">
                              <i class="fa-solid fa-folder text-lg"></i>
                          </div>
                          <h4 class="ml-3 font-semibold text-white">${category.charAt(0).toUpperCase() + category.slice(1)}</h4>
                      </div>
                      <p class="text-sm text-gray-400 mb-3">${category} APIs</p>
                      <div class="flex items-center gap-2">
                          ${getCount > 0 ? `<span class="bg-blue-900/30 text-blue-400 px-2 py-0.5 rounded text-xs font-medium">${getCount} GET</span>` : ''}
                          ${postCount > 0 ? `<span class="bg-green-900/30 text-green-400 px-2 py-0.5 rounded text-xs font-medium">${postCount} POST</span>` : ''}
                          ${putCount > 0 ? `<span class="bg-yellow-900/30 text-yellow-400 px-2 py-0.5 rounded text-xs font-medium">${putCount} PUT</span>` : ''}
                      </div>
                  `;
                  categoryCards.appendChild(card);
              });

              // Populate API lists
              const apiLists = document.getElementById('api-lists');
              apiLists.innerHTML = '';
              Object.keys(apiData.categories).forEach(category => {
                  const categoryApis = apiData.categories[category];
                  const listDiv = document.createElement('div');
                  listDiv.className = 'api-list hidden';
                  listDiv.id = `${category}-apis`;
                  const grid = document.createElement('div');
                  grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';

                  categoryApis.forEach(api => {
                      const card = document.createElement('div');
                      card.className = 'p-4 rounded-lg border border-gray-700 shadow-sm hover:shadow-md transition-all cursor-pointer api-card';
                      card.dataset.api = api.name.toLowerCase().replace(/\s+/g, '-');
                      card.dataset.endpoint = api.endpoint;
                      card.dataset.method = api.method;
                      card.dataset.category = category;
                      card.innerHTML = `
                          <div class="flex items-center justify-between mb-3">
                              <h4 class="font-semibold text-white">${api.name}</h4>
                              <span class="px-2 py-1 ${api.method === 'GET' ? 'bg-blue-900/30 text-blue-400' : 'bg-green-900/30 text-green-400'} text-xs font-medium rounded">${api.method}</span>
                          </div>
                          <p class="text-sm text-gray-400 mb-3">${api.name} API</p>
                          <div class="text-xs text-gray-400 font-mono bg-gray-700/50 p-2 rounded mb-3">${api.endpoint}</div>
                          <div class="flex items-center justify-between">
                              <div class="flex items-center text-sm text-gray-400">
                                  <i class="fa-solid fa-clock mr-1 text-xs"></i>
                                  ${Math.floor(Math.random() * 100 + 100)}ms avg
                              </div>
                              <button class="text-purple-400 hover:text-purple-300 text-sm font-medium">Test API</button>
                          </div>
                      `;
                      grid.appendChild(card);
                  });

                  listDiv.appendChild(grid);
                  apiLists.appendChild(listDiv);
              });

              // Reattach event listeners for category cards
              attachCategoryEventListeners();
          } catch (error) {
              console.error('Error fetching API data:', error);
          }
      }

      // Update API calls dynamically
      function updateApiCalls() {
          document.getElementById('api-calls-today').textContent = apiData.stats.apiCalls.totalCallsToday.toLocaleString();
          document.getElementById('peak-calls').textContent = apiData.stats.apiCalls.peakCallsPerMinute;
          const change = apiData.stats.apiCalls.totalCallsToday > 0 ? Math.round((apiData.stats.apiCalls.totalCallsToday - 1000) / 1000 * 100) : 0;
          document.getElementById('api-calls-change').textContent = `${change >= 0 ? '+' : ''}${change}% from yesterday`;
      }

      // Simulate server performance
      function updateServerPerformance() {
          const now = new Date();
          const elapsedSeconds = (now - serverStartTime) / 1000;

          const responseTime = Math.floor(Math.random() * 100 + 100);
          averageResponseTime = (averageResponseTime * responseTimeCount + responseTime) / (responseTimeCount + 1);
          responseTimeCount++;
          const change = Math.round(responseTime - averageResponseTime);

          document.getElementById('response-time').textContent = `${responseTime}ms`;
          document.getElementById('response-time-change').textContent = `${change >= 0 ? '+' : ''}${change}ms from average`;

          const cpuUsage = Math.floor(Math.random() * 20 + 20);
          document.getElementById('cpu-usage').textContent = `${cpuUsage}%`;

          const memoryUsage = (Math.random() * 2 + 2).toFixed(1);
          document.getElementById('memory-usage').textContent = `${memoryUsage}GB/8GB`;
      }

      // Update clock, uptime, and performance
      function updateClockAndStats() {
          const now = new Date();
          const timeString = now.toLocaleTimeString();
          document.getElementById('current-time').textContent = timeString;

          document.getElementById('last-updated').textContent = 'Just now';

          const elapsedSeconds = (now - serverStartTime) / 1000;
          const uptimePercentage = Math.min(100, 99.9 + Math.sin(elapsedSeconds / 10000) * 0.1).toFixed(2);
          document.getElementById('server-uptime').textContent = `${uptimePercentage}%`;

          updateServerPerformance();

          fetch('/api/metadata').then(response => response.json()).then(data => {
              apiData.stats = data.stats;
              updateApiCalls();
          });
      }

      // Mobile sidebar toggle
      document.getElementById('open-sidebar').addEventListener('click', () => {
          document.getElementById('sidebar').classList.add('active');
          document.getElementById('overlay').classList.add('active');
      });

      document.getElementById('close-sidebar').addEventListener('click', () => {
          document.getElementById('sidebar').classList.remove('active');
          document.getElementById('overlay').classList.remove('active');
      });

      document.getElementById('overlay').addEventListener('click', () => {
          document.getElementById('sidebar').classList.remove('active');
          document.getElementById('overlay').classList.remove('active');
      });

      // Show API list when category is clicked
      function attachCategoryEventListeners() {
          document.querySelectorAll('.category-link, .category-card').forEach(item => {
              item.addEventListener('click', event => {
                  event.preventDefault();
                  const category = item.dataset.category;
                  document.getElementById('dashboard-overview').classList.add('hidden');
                  document.getElementById('api-categories').classList.add('hidden');
                  document.getElementById('api-list-section').classList.remove('hidden');

                  document.querySelectorAll('.api-list').forEach(list => {
                      list.classList.add('hidden');
                  });

                  document.getElementById(`${category}-apis`).classList.remove('hidden');

                  document.getElementById('category-title').textContent = category.charAt(0).toUpperCase() + category.slice(1);

                  document.querySelectorAll('.category-link').forEach(link => {
                      link.classList.remove('bg-purple-900/30', 'text-purple-400');
                      link.classList.add('hover:bg-gray-700/50');
                  });
                  document.querySelector(`.category-link[data-category="${category}"]`).classList.add('bg-purple-900/30', 'text-purple-400');
                  document.querySelector(`.category-link[data-category="${category}"]`).classList.remove('hover:bg-gray-700/50');

                  document.getElementById('sidebar').classList.remove('active');
                  document.getElementById('overlay').classList.remove('active');
              });
          });
      }

      // Back to categories
      document.getElementById('back-to-categories').addEventListener('click', () => {
          document.getElementById('dashboard-overview').classList.remove('hidden');
          document.getElementById('api-categories').classList.remove('hidden');
          document.getElementById('api-list-section').classList.add('hidden');
      });

      // Tab switching in modal
      document.querySelectorAll('.tab-button').forEach(button => {
          button.addEventListener('click', () => {
              document.querySelectorAll('.tab-button').forEach(btn => {
                  btn.classList.remove('bg-purple-600', 'text-white');
                  btn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
              });
              button.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
              button.classList.add('bg-purple-600', 'text-white');

              document.querySelectorAll('.tab-content').forEach(content => {
                  content.classList.remove('active');
              });
              document.getElementById(`${button.dataset.tab}-tab`).classList.add('active');
          });
      });

      // Body tab switching (Form Inputs vs Raw JSON)
      document.querySelectorAll('.body-tab-button').forEach(button => {
          button.addEventListener('click', () => {
              document.querySelectorAll('.body-tab-button').forEach(btn => {
                  btn.classList.remove('active');
              });
              button.classList.add('active');

              document.querySelectorAll('.body-tab-content').forEach(content => {
                  content.classList.remove('active');
              });
              document.getElementById(`body-${button.dataset.bodyTab}-container`).classList.add('active');

              updateRequestBodyPreview();
          });
      });

      // Show API test modal
      document.addEventListener('click', event => {
          const apiCard = event.target.closest('.api-card');
          if (apiCard) {
              const apiName = apiCard.dataset.api;
              const endpoint = apiCard.dataset.endpoint;
              const method = apiCard.dataset.method;
              const category = apiCard.dataset.category;

              // Find the API in apiData
              const api = apiData.categories[category].find(api => api.name.toLowerCase().replace(/\s+/g, '-') === apiName);
              currentApiParams = api.params || [];

              const modal = document.getElementById('api-test-modal');

              // Update modal content
              document.getElementById('modal-title').textContent = `Test API: ${apiName.charAt(0).toUpperCase() + apiName.slice(1).replace('-', ' ')}`;
              document.getElementById('modal-method').textContent = method;
              document.getElementById('modal-method').className = `px-2 py-1 ${method === 'GET' ? 'bg-blue-900/30 text-blue-400' : 'bg-green-900/30 text-green-400'} text-xs font-medium rounded mr-2`;
              document.getElementById('modal-endpoint').textContent = endpoint;
              document.getElementById('modal-description').textContent = `${apiName} API`;
              document.getElementById('modal-response').innerHTML = `<pre>{}</pre>`;
              document.getElementById('modal-response-status').textContent = 'Status: Not Sent';

              // Populate params or body inputs
              if (method === 'GET') {
                  const paramsContainer = document.getElementById('params-container');
                  paramsContainer.innerHTML = '';
                  currentApiParams.forEach(param => {
                      const div = document.createElement('div');
                      div.className = 'mb-4';
                      div.innerHTML = `
                          <label class="block text-sm font-medium text-gray-300 mb-1">${param.name} (${param.type})${param.required ? ' <span class="text-red-400">*</span>' : ''}</label>
                          <input type="text" name="${param.name}" placeholder="${param.description}" class="w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-gray-200" ${param.required ? 'required' : ''}>
                          <p class="error-message hidden">This field is required</p>
                      `;
                      paramsContainer.appendChild(div);
                  });
                  document.getElementById('body-inputs').innerHTML = '<p class="text-sm text-gray-400">GET requests do not require a request body.</p>';
                  document.getElementById('body-raw-container').classList.add('hidden');
              } else if (method === 'POST') {
                  const bodyInputs = document.getElementById('body-inputs');
                  bodyInputs.innerHTML = '';
                  currentApiParams.forEach(param => {
                      const div = document.createElement('div');
                      div.className = 'mb-4';
                      div.innerHTML = `
                          <label class="block text-sm font-medium text-gray-300 mb-1">${param.name} (${param.type})${param.required ? ' <span class="text-red-400">*</span>' : ''}</label>
                          <input type="text" name="${param.name}" placeholder="${param.description}" class="w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-gray-200" ${param.required ? 'required' : ''}>
                          <p class="error-message hidden">This field is required</p>
                      `;
                      bodyInputs.appendChild(div);
                  });
                  document.getElementById('body-raw-container').classList.remove('hidden');
                  document.getElementById('params-container').innerHTML = '<p class="text-sm text-gray-400">POST requests use the request body for parameters.</p>';
              }

              // Update request body preview
              updateRequestBodyPreview();

              // Show modal
              modal.classList.remove('hidden');
              setTimeout(() => {
                  modal.classList.add('active');
              }, 10);
          }
      });

      // Update request body preview
      function updateRequestBodyPreview() {
          const method = document.getElementById('modal-method').textContent;
          let requestBody = {};

          if (method === 'POST') {
              const activeBodyTab = document.querySelector('.body-tab-button.active').dataset.bodyTab;
              if (activeBodyTab === 'form') {
                  currentApiParams.forEach(param => {
                      const input = document.querySelector(`#body-inputs input[name="${param.name}"]`);
                      if (input && input.value) {
                          requestBody[param.name] = input.value;
                      }
                  });
              } else if (activeBodyTab === 'raw') {
                  const rawInput = document.getElementById('raw-json-input').value;
                  try {
                      requestBody = JSON.parse(rawInput || '{}');
                      document.getElementById('raw-json-input').classList.remove('input-error');
                      document.querySelector('#body-raw-container .error-message').classList.add('hidden');
                  } catch (e) {
                      requestBody = {};
                      document.getElementById('raw-json-input').classList.add('input-error');
                      document.querySelector('#body-raw-container .error-message').classList.remove('hidden');
                  }
              }
          }

          document.getElementById('modal-request-body').innerHTML = `<pre>${JSON.stringify(requestBody, null, 2)}</pre>`;
      }

      // Update request body preview on input change
      document.getElementById('body-inputs').addEventListener('input', updateRequestBodyPreview);
      document.getElementById('raw-json-input').addEventListener('input', updateRequestBodyPreview);

      // Reset modal
      document.getElementById('reset-request').addEventListener('click', () => {
          document.querySelectorAll('#params-container input, #body-inputs input').forEach(input => {
              input.value = '';
              input.classList.remove('input-error');
              input.nextElementSibling.classList.add('hidden');
          });
          document.getElementById('raw-json-input').value = '';
          document.getElementById('raw-json-input').classList.remove('input-error');
          document.querySelector('#body-raw-container .error-message').classList.add('hidden');
          document.querySelector('input[name="authorization"]').value = '';
          document.querySelector('input[name="x-user-role"]').value = 'user';
          document.getElementById('modal-response').innerHTML = `<pre>{}</pre>`;
          document.getElementById('modal-response-status').textContent = 'Status: Not Sent';
          updateRequestBodyPreview();
      });

      // Send Request
      document.getElementById('send-request').addEventListener('click', async () => {
          const method = document.getElementById('modal-method').textContent;
          const endpoint = document.getElementById('modal-endpoint').textContent;
          const headers = {
              'Content-Type': 'application/json',
              'Authorization': document.querySelector('input[name="authorization"]').value,
              'x-user-role': document.querySelector('input[name="x-user-role"]').value || 'user',
          };

          let url = endpoint;
          let body = null;
          let isValid = true;

          if (method === 'GET') {
              const params = {};
              currentApiParams.forEach(param => {
                  const input = document.querySelector(`#params-container input[name="${param.name}"]`);
                  if (param.required && (!input.value || input.value.trim() === '')) {
                      input.classList.add('input-error');
                      input.nextElementSibling.classList.remove('hidden');
                      isValid = false;
                  } else {
                      input.classList.remove('input-error');
                      input.nextElementSibling.classList.add('hidden');
                      if (input && input.value) {
                          params[param.name] = input.value;
                      }
                  }
              });
              if (!isValid) return;
              const queryString = new URLSearchParams(params).toString();
              if (queryString) {
                  url = `${endpoint}?${queryString}`;
              }
          } else if (method === 'POST') {
              const activeBodyTab = document.querySelector('.body-tab-button.active').dataset.bodyTab;
              let requestBody = {};

              if (activeBodyTab === 'form') {
                  currentApiParams.forEach(param => {
                      const input = document.querySelector(`#body-inputs input[name="${param.name}"]`);
                      if (param.required && (!input.value || input.value.trim() === '')) {
                          input.classList.add('input-error');
                          input.nextElementSibling.classList.remove('hidden');
                          isValid = false;
                      } else {
                          input.classList.remove('input-error');
                          input.nextElementSibling.classList.add('hidden');
                          if (input && input.value) {
                              requestBody[param.name] = input.value;
                          }
                      }
                  });
              } else if (activeBodyTab === 'raw') {
                  const rawInput = document.getElementById('raw-json-input').value;
                  try {
                      requestBody = JSON.parse(rawInput || '{}');
                      document.getElementById('raw-json-input').classList.remove('input-error');
                      document.querySelector('#body-raw-container .error-message').classList.add('hidden');
                  } catch (e) {
                      document.getElementById('raw-json-input').classList.add('input-error');
                      document.querySelector('#body-raw-container .error-message').classList.remove('hidden');
                      isValid = false;
                  }
              }

              if (!isValid) return;
              body = JSON.stringify(requestBody);
          }

          try {
              const startTime = performance.now();
              const response = await fetch(url, {
                  method: method,
                  headers: headers,
                  body: body,
              });
              const endTime = performance.now();
              const responseTime = Math.round(endTime - startTime);

              const data = await response.json();
              document.getElementById('modal-response').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
              document.getElementById('modal-response-status').textContent = `Status: ${response.status} ${response.statusText}`;

              averageResponseTime = (averageResponseTime * responseTimeCount + responseTime) / (responseTimeCount + 1);
              responseTimeCount++;
              const change = Math.round(responseTime - averageResponseTime);
              document.getElementById('response-time').textContent = `${responseTime}ms`;
              document.getElementById('response-time-change').textContent = `${change >= 0 ? '+' : ''}${change}ms from average`;
          } catch (error) {
              document.getElementById('modal-response').innerHTML = `<pre>{ "error": "${error.message}" }</pre>`;
              document.getElementById('modal-response-status').textContent = 'Status: Error';
          }
      });

      // Close modal
      function closeModal() {
          const modal = document.getElementById('api-test-modal');
          modal.classList.remove('active');
          setTimeout(() => {
              modal.classList.add('hidden');
          }, 300);
      }

      document.getElementById('close-modal').addEventListener('click', closeModal);
      document.getElementById('close-modal-btn').addEventListener('click', closeModal);
      document.getElementById('api-test-modal').addEventListener('click', event => {
          if (event.target === document.getElementById('api-test-modal')) {
              closeModal();
          }
      });

      // Initial fetch and periodic updates
      fetchApiData();
      updateClockAndStats();
      setInterval(updateClockAndStats, 1000);

// Filter and sort APIs
document.getElementById('method-filter').addEventListener('change', filterApis);
document.getElementById('sort-filter').addEventListener('change', filterApis);

function filterApis() {
    const methodFilter = document.getElementById('method-filter').value;
    const sortFilter = document.getElementById('sort-filter').value;
    const activeCategoryElement = document.querySelector('.api-list:not(.hidden)');
    
    // If no active category is found, exit early
    if (!activeCategoryElement) {
        console.warn('No active category found for filtering APIs.');
        return;
    }

    const activeCategory = activeCategoryElement.id.replace('-apis', '');
    const categoryApis = apiData.categories[activeCategory];

    // If category APIs are not found, exit early
    if (!categoryApis || categoryApis.length === 0) {
        console.warn(`No APIs found for category: ${activeCategory}`);
        const listDiv = document.getElementById(`${activeCategory}-apis`);
        listDiv.innerHTML = '<p class="text-sm text-gray-400">No APIs available.</p>';
        return;
    }

    // Clone the APIs array to avoid mutating the original
    let filteredApis = [...categoryApis];

    // Apply method filter
    if (methodFilter !== 'All Methods') {
        filteredApis = filteredApis.filter(api => api.method === methodFilter);
    }

    // Apply sorting
    if (sortFilter === 'Sort by Name') {
        filteredApis.sort((a, b) => a.name.localeCompare(b.name));
    } else if (sortFilter === 'Sort by Method') {
        filteredApis.sort((a, b) => a.method.localeCompare(b.method));
    }

    // Update the API list
    const listDiv = document.getElementById(`${activeCategory}-apis`);
    listDiv.innerHTML = ''; // Clear the existing list

    const grid = document.createElement('div');
    grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';

    if (filteredApis.length === 0) {
        grid.innerHTML = '<p class="text-sm text-gray-400">No APIs match the selected filters.</p>';
    } else {
        filteredApis.forEach(api => {
            const card = document.createElement('div');
            card.className = 'p-4 rounded-lg border border-gray-700 shadow-sm hover:shadow-md transition-all cursor-pointer api-card';
            card.dataset.api = api.name.toLowerCase().replace(/\s+/g, '-');
            card.dataset.endpoint = api.endpoint;
            card.dataset.method = api.method;
            card.dataset.category = activeCategory;

            // Use a static or precomputed response time for consistency
            const responseTime = api.responseTime || Math.floor(Math.random() * 100 + 100);

            card.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-semibold text-white">${api.name}</h4>
                    <span class="px-2 py-1 ${
                        api.method === 'GET' ? 'bg-blue-900/30 text-blue-400' : 'bg-green-900/30 text-green-400'
                    } text-xs font-medium rounded">${api.method}</span>
                </div>
                <p class="text-sm text-gray-400 mb-3">${api.name} API</p>
                <div class="text-xs text-gray-400 font-mono bg-gray-700/50 p-2 rounded mb-3">${api.endpoint}</div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center text-sm text-gray-400">
                        <i class="fa-solid fa-clock mr-1 text-xs"></i>
                        ${responseTime}ms avg
                    </div>
                    <button class="text-purple-400 hover:text-purple-300 text-sm font-medium">Test API</button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    listDiv.appendChild(grid);
}
  </script>
</body>
</html>